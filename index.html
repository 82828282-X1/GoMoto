<!DOCTYPE html>
<html>
<head>
    <title>GoMoto</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #333;
        }

        .input-container {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 10px;
        }

        input[type="text"] {
            width: 70%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 20px;
            font-size: 16px;
        }

        .btn {
            width: 120px;
            height: 40px;
            background-color: #E63946;
            color: #FFF;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #D62839;
        }

        #map {
            height: 400px;
            width: 100%;
            margin: 10px 0;
        }

        #info-container {
            text-align: center;
            margin: 10px;
        }

        select {
            padding: 8px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 10px;
            width: 90%;
            text-align: center;
        }

        #confirmation-icon {
            width: 50px;
            height: 50px;
            margin: 10px auto;
            display: block;
        }
    </style>
</head>
<body>
<div class="input-container">
    <input type="text" id="dropOffInput" placeholder="Enter pickup location">
    <button class="btn" onclick="useCurrentLocation()">Current Location</button>
</div>

<div class="input-container">
    <input type="text" id="destinationInput" placeholder="Enter destination location">
</div>

<div id="map"></div>

<div id="info-container">
    <div id="info-text">Your journey details will appear here...</div>
    <select id="paymentMethod">
        <option value="" disabled selected>Payment Method</option>
        <option value="Cash">Cash</option>
        <option value="Airtel Money">Airtel Money</option>
        <option value="Tnm Mpamba">Tnm Mpamba</option>
        <option value="Credit Card">Credit Card</option>
    </select>
    <button class="btn" onclick="confirmRide()">Confirm Ride</button>
</div>

<script>
    let map, pickupMarker, destinationMarker, vehicleMarker;
    let autocompletePickup, autocompleteDestination;
    let directionsService, directionsRenderer;

    const vehicleIcon = "http://maps.google.com/mapfiles/ms/icons/cabs.png"; // Replace with car/bike icons
    const redMarkerIcon = "http://maps.google.com/mapfiles/ms/icons/red-dot.png";

    function initMap() {
        const center = { lat: -13.9833, lng: 33.7833 }; // Default to Lilongwe
        map = new google.maps.Map(document.getElementById("map"), {
            center: center,
            zoom: 13,
        });

        directionsService = new google.maps.DirectionsService();
        directionsRenderer = new google.maps.DirectionsRenderer({ suppressMarkers: true });
        directionsRenderer.setMap(map);

        // Autocomplete restricted to Malawi
        autocompletePickup = new google.maps.places.Autocomplete(document.getElementById("dropOffInput"), {
            componentRestrictions: { country: "MW" }
        });

        autocompleteDestination = new google.maps.places.Autocomplete(document.getElementById("destinationInput"), {
            componentRestrictions: { country: "MW" }
        });

        autocompletePickup.addListener("place_changed", () => {
            const place = autocompletePickup.getPlace();
            setMarker(place.geometry.location, "pickup");
        });

        autocompleteDestination.addListener("place_changed", () => {
            const place = autocompleteDestination.getPlace();
            setMarker(place.geometry.location, "destination");
            calculateRoute();
        });
    }

    function setMarker(location, type) {
        const icon = redMarkerIcon;
        if (type === "pickup") {
            if (pickupMarker) pickupMarker.setMap(null);
            pickupMarker = new google.maps.Marker({
                position: location,
                map: map,
                icon: icon,
                label: "A"
            });
        } else if (type === "destination") {
            if (destinationMarker) destinationMarker.setMap(null);
            destinationMarker = new google.maps.Marker({
                position: location,
                map: map,
                icon: icon,
                label: "B"
            });
        }
    }

    function useCurrentLocation() {
        navigator.geolocation.getCurrentPosition(position => {
            const coords = { lat: position.coords.latitude, lng: position.coords.longitude };
            setMarker(coords, "pickup");
            map.setCenter(coords);
        });
    }

    function calculateRoute() {
        if (!pickupMarker || !destinationMarker) return;

        directionsService.route({
            origin: pickupMarker.getPosition(),
            destination: destinationMarker.getPosition(),
            travelMode: "DRIVING",
        }, (response, status) => {
            if (status === "OK") {
                directionsRenderer.setDirections(response);
                const leg = response.routes[0].legs[0];
                document.getElementById("info-text").innerText = `Distance: ${leg.distance.text}, Price: MK ${(leg.distance.value / 1000 * 1500).toFixed(2)}`;
            }
        });
    }

    function confirmRide() {
        const paymentMethod = document.getElementById("paymentMethod").value;
        if (!paymentMethod || !pickupMarker || !destinationMarker) {
            alert("Please complete all fields.");
            return;
        }

        showConfirmationPopup();
        simulateVehicleToPickup();
    }

    function showConfirmationPopup() {
        const confirmationPopup = `
            <div>
                <img src="https://cdn-icons-png.flaticon.com/512/2907/2907764.png" id="confirmation-icon" alt="Success">
                <h3>Ride Confirmed!</h3>
                <p>Your driver is on the way!</p>
            </div>
        `;
        const popup = document.createElement("div");
        popup.innerHTML = confirmationPopup;
        popup.style.position = "fixed";
        popup.style.top = "50%";
        popup.style.left = "50%";
        popup.style.transform = "translate(-50%, -50%)";
        popup.style.background = "#fff";
        popup.style.padding = "20px";
        popup.style.borderRadius = "10px";
        popup.style.boxShadow = "0 2px 4px rgba(0,0,0,0.2)";
        document.body.appendChild(popup);

        setTimeout(() => {
            popup.remove();
        }, 3000);
    }

    function simulateVehicleToPickup() {
        if (!pickupMarker) return;

        vehicleMarker = new google.maps.Marker({
            position: { lat: pickupMarker.getPosition().lat() + 0.01, lng: pickupMarker.getPosition().lng() + 0.01 },
            map: map,
            icon: vehicleIcon,
            title: "Driver on the way!"
        });

        const interval = setInterval(() => {
            const currentPos = vehicleMarker.getPosition();
            const nextLat = currentPos.lat() - 0.0001;
            const nextLng = currentPos.lng() - 0.0001;
            vehicleMarker.setPosition(new google.maps.LatLng(nextLat, nextLng));

            if (Math.abs(nextLat - pickupMarker.getPosition().lat()) < 0.00005) {
                clearInterval(interval);
            }
        }, 50);
    }

    window.onload = initMap;
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDvMFiXrKuTBCoDhsxxoYJ2BJiUgFEgrFg&libraries=places&callback=initMap" async defer></script>
</body>
</html>

